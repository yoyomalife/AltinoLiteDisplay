<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œí‹°ë…¸ ë¼ì´íŠ¸ ë””ìŠ¤í”Œë ˆì´</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* í°íŠ¸ ì ìš© (Inter) */
        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-tap-highlight-color: transparent; /* ëª¨ë°”ì¼ í´ë¦­ ì‹œ íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
        }
        /* ê·¸ë¦¬ë“œ ì…€ì˜ í¬ê¸°ë¥¼ ë·°í¬íŠ¸ì— ë”°ë¼ ì¡°ì ˆí•˜ê³  ì •ì‚¬ê°í˜• ë¹„ìœ¨ ìœ ì§€ (ìˆ˜ì •ë¨) */
        .grid-cell {
            width: 10vw; /* ë·°í¬íŠ¸ ë„ˆë¹„ì˜ 10% */
            max-width: 40px; /* ìµœëŒ€ í¬ê¸° ì œí•œ */
            aspect-ratio: 1 / 1; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ ê°•ì œ */
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            /* heightì™€ max-heightëŠ” aspect-ratioê°€ ì²˜ë¦¬í•˜ë„ë¡ ì œê±° */
        }
        /* ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .axis-label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; /* 12px */
            color: #4B5563; /* gray-600 */
            font-weight: 500;
        }
        /* í•©ê³„ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .hex-sum-box {
            font-family: 'Courier New', Courier, monospace; /* ë³µì‚¬ ë¬¸ìì—´ê³¼ ë™ì¼í•œ í°íŠ¸ */
            font-weight: 600;
            font-size: 0.875rem; /* 14px */
            padding: 0.25rem;
            background-color: #F3F4F6; /* gray-100 */
            border: 1px solid #D1D5DB; /* gray-300 */
            border-radius: 0.375rem; /* 6px */
            text-align: center;
            height: 40px; /* ê³ ì • ë†’ì´ */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1D4ED8; /* íŒŒë€ ê³„ì—´ (Tailwind blue-700) */
        }
        /* 16ì§„ìˆ˜ í•©ê³„ ìœ„ì˜ ì—´ ë¼ë²¨ */
        .col-sum-label {
            font-size: 0.75rem; /* 12px */
            color: #4B5563; /* gray-600 */
            font-weight: 500;
            text-align: center;
            margin-bottom: 0.25rem; /* 4px */
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-xl w-full max-w-md mx-auto">
        
        <!-- ì œëª© (ê·¸ë¼ë°ì´ì…˜ ì ìš©) -->
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-blue-600 mb-2">
            ì•Œí‹°ë…¸ ë¼ì´íŠ¸ ë””ìŠ¤í”Œë ˆì´
        </h1>

        <!-- ê·¸ë¦¬ë“œ ë° ë¼ë²¨ ì»¨í…Œì´ë„ˆ (ìˆ˜ì •ë¨) -->
        <div class="mt-6">
            <!-- IDë¥¼ ë¶€ì—¬í•˜ì—¬ JSê°€ ì œì–´í•˜ë„ë¡ ë³€ê²½ -->
            <div id="main-grid" class="grid grid-cols-9 gap-1 items-center">
                <!-- JavaScriptë¡œ Yì¶• ë¼ë²¨, 8x8 ê·¸ë¦¬ë“œ, Xì¶• ë¼ë²¨ì´ ë™ì  ìƒì„±ë©ë‹ˆë‹¤. -->
                <!-- (ê¸°ì¡´ Xì¶• ë¼ë²¨ HTMLì€ JSë¡œ ì´ë™) -->
            </div>
        </div>

        <!-- 16ì§„ìˆ˜ í•©ê³„ ë””ìŠ¤í”Œë ˆì´ -->
        <div class="mt-6">
            <div id="hex-sum-container" class="grid grid-cols-8 gap-1">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
            </div>
        </div>

        <!-- 16ì§„ìˆ˜ ê°’ ë¬¸ìì—´ ë° ë³µì‚¬ ë²„íŠ¼ -->
        <div class="mt-4 p-3 bg-gray-100 rounded-lg flex items-center justify-between space-x-2">
            <code id="display-line-string" class="text-sm text-gray-700 whitespace-nowrap overflow-x-auto overflow-y-hidden pb-1" style="font-family: 'Courier New', Courier, monospace;">
                0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
            </code>
            <button id="copy-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-1.5 px-3 rounded-md text-xs transition-colors duration-200 flex-shrink-0">
                ë³µì‚¬
            </button>
        </div>


        <!-- AI ì´ë¯¸ì§€ ìƒì„± (í‚¤ì›Œë“œ ì…ë ¥ + ë²„íŠ¼) -->
        <div class="mt-8 flex items-center space-x-2">
            <input type="text" id="keyword-input" placeholder="í‚¤ì›Œë“œ ì…ë ¥ (ì˜ˆ: heart)" class="flex-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
            <button id="ai-image-button" class="bg-teal-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50">
                âœ¨ AI ìƒì„±
            </button>
        </div>

        <!-- AI ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="ai-status-message" class="text-center text-sm text-gray-600 mt-2 h-5"></div>

        <!-- ë¦¬ì…‹ ë²„íŠ¼ (ì œì¼ í•˜ë‹¨ìœ¼ë¡œ ì´ë™ ë° ìƒë‹¨ ë§ˆì§„ ì¶”ê°€) -->
        <button id="reset-button" class="mt-4 w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
            ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°
        </button>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // const gridContainer = document.querySelector('.grid.grid-cols-9'); // (ê¸°ì¡´)
            const gridContainer = document.getElementById('main-grid'); // (ìˆ˜ì •) IDë¡œ ì„ íƒ
            const hexSumContainer = document.getElementById('hex-sum-container');
            const resetButton = document.getElementById('reset-button');
            const displayLineString = document.getElementById('display-line-string');
            const copyButton = document.getElementById('copy-button');

            // AI ìƒì„± ê´€ë ¨ UI ìš”ì†Œ
            const aiImageButton = document.getElementById('ai-image-button');
            const keywordInput = document.getElementById('keyword-input');
            const aiStatusMessage = document.getElementById('ai-status-message');
            
            // Yì¶• ë¼ë²¨ (í–‰) - ìƒë‹¨(0x80)ë¶€í„° í•˜ë‹¨(0x01) ìˆœì„œë¡œ ë³€ê²½
            const yLabels = ['0x80', '0x40', '0x20', '0x10', '0x08', '0x04', '0x02', '0x01'];
            // Xì¶• ë¼ë²¨ (ì—´)
            const xLabels = ['1', '2', '3', '4', '5', '6', '7', '8'];

            // --- 1. 8x8 ê·¸ë¦¬ë“œ ë° ë¼ë²¨ UI ìƒì„± (ìˆ˜ì •ë¨) ---

            // 1-1. Yì¶• ë¼ë²¨ (í–‰) ë° 8x8 ê·¸ë¦¬ë“œ ì…€ ìƒì„±
            yLabels.forEach(rowLabel => {
                // Yì¶• ë¼ë²¨ (í–‰)
                const yLabelDiv = document.createElement('div');
                yLabelDiv.className = 'axis-label';
                yLabelDiv.textContent = rowLabel;
                gridContainer.appendChild(yLabelDiv);

                // 8ê°œì˜ ê·¸ë¦¬ë“œ ì…€
                xLabels.forEach(colLabel => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell bg-gray-200 rounded-md cursor-pointer transition-colors duration-150';
                    cell.dataset.row = rowLabel; // í–‰ ê°’ (ì˜ˆ: 0x80)
                    cell.dataset.col = colLabel; // ì—´ ê°’ (ì˜ˆ: 1)
                    gridContainer.appendChild(cell);
                });
            });

            // 1-1-B. Xì¶• ë¼ë²¨ (ì—´)ì„ í•˜ë‹¨ì— ìƒì„± (ìƒˆë¡œ ì¶”ê°€)
            // (0,0) ë¹ˆ ì½”ë„ˆ
            gridContainer.appendChild(document.createElement('div'));

            // 8ê°œì˜ Xì¶• ë¼ë²¨
            xLabels.forEach(colLabel => {
                const xLabelDiv = document.createElement('div');
                xLabelDiv.className = 'axis-label pt-2'; // ìƒë‹¨ íŒ¨ë”©(pt-2) ì¶”ê°€
                xLabelDiv.textContent = colLabel;
                gridContainer.appendChild(xLabelDiv);
            });


            // 1-2. 16ì§„ìˆ˜ í•©ê³„ ë””ìŠ¤í”Œë ˆì´ ìƒì„±
            xLabels.forEach(colLabel => {
                const colWrapper = document.createElement('div');
                
                const labelDiv = document.createElement('div');
                labelDiv.className = 'col-sum-label';
                labelDiv.textContent = `${colLabel}ì—´`; // "nì—´" í˜•ì‹
                colWrapper.appendChild(labelDiv);

                const sumBox = document.createElement('div');
                sumBox.className = 'hex-sum-box';
                sumBox.id = `hex-sum-${colLabel}`; // ID ë¶€ì—¬ (ì˜ˆ: hex-sum-1)
                sumBox.textContent = '0x00';
                colWrapper.appendChild(sumBox);

                hexSumContainer.appendChild(colWrapper);
            });

            // --- 2. í•µì‹¬ ë¡œì§ í•¨ìˆ˜ ---

            /**
             * ê° ì—´ì˜ 16ì§„ìˆ˜ í•©ê³„ë¥¼ ê³„ì‚°í•˜ê³  UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
             */
            function updateHexSums() {
                const columnSums = {}; // ì˜ˆ: { '1': 0, '2': 0, ... }
                xLabels.forEach(col => columnSums[col] = 0);

                // ëª¨ë“  í™œì„±í™”ëœ(ë¹¨ê°„ìƒ‰) ì…€ ì°¾ê¸°
                const activeCells = document.querySelectorAll('.grid-cell.bg-red-500');

                activeCells.forEach(cell => {
                    const col = cell.dataset.col; // '1', '2', ...
                    const rowHexValue = parseInt(cell.dataset.row); // '0x80' -> 128
                    
                    if (columnSums[col] !== undefined) {
                        columnSums[col] |= rowHexValue; // ë¹„íŠ¸ OR ì—°ì‚°ìœ¼ë¡œ í•©ì‚°
                    }
                });

                // UI ì—…ë°ì´íŠ¸
                const hexValues = []; // DisplayLineìš© ë°°ì—´
                xLabels.forEach(col => {
                    const sum = columnSums[col];
                    const hexString = '0x' + sum.toString(16).toUpperCase().padStart(2, '0');
                    document.getElementById(`hex-sum-${col}`).textContent = hexString;
                    hexValues.push(hexString);
                });

                // 16ì§„ìˆ˜ ê°’ ë¬¸ìì—´ ì—…ë°ì´íŠ¸ (DisplayLine() ì œê±°)
                displayLineString.textContent = hexValues.join(', ');
            }

            // --- 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ---

            // 3-1. ì…€ í´ë¦­ ì´ë²¤íŠ¸ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©)
            gridContainer.addEventListener('click', (event) => {
                // í´ë¦­ëœ ìš”ì†Œê°€ .grid-cellì¸ì§€ í™•ì¸
                if (event.target.classList.contains('grid-cell')) {
                    const cell = event.target;
                    // í´ë˜ìŠ¤ë¥¼ í† ê¸€ (ë¹¨ê°„ìƒ‰ <-> íšŒìƒ‰)
                    cell.classList.toggle('bg-red-500');
                    cell.classList.toggle('bg-gray-200');
                    
                    // 16ì§„ìˆ˜ í•©ê³„ ë‹¤ì‹œ ê³„ì‚°
                    updateHexSums();
                }
            });

            // 3-2. ë¦¬ì…‹ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            resetButton.addEventListener('click', () => {
                const allCells = document.querySelectorAll('.grid-cell');
                allCells.forEach(cell => {
                    cell.classList.remove('bg-red-500');
                    cell.classList.add('bg-gray-200');
                });
                
                // 16ì§„ìˆ˜ í•©ê³„ ì—…ë°ì´íŠ¸ (0ìœ¼ë¡œ ë¦¬ì…‹)
                updateHexSums();
                
                // AI ì…ë ¥ ë° ìƒíƒœ ì´ˆê¸°í™”
                keywordInput.value = '';
                aiStatusMessage.textContent = '';
                aiStatusMessage.classList.remove('text-red-600', 'text-blue-600');
            });

            // 3-3. ë³µì‚¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            copyButton.addEventListener('click', () => {
                // ì´ì œ displayLineString.textContentëŠ” "0x00, 0x00, ..." í˜•ì‹ì„
                const textToCopy = displayLineString.textContent;

                // document.execCommandë¥¼ ì‚¬ìš©í•œ í´ë¦½ë³´ë“œ ë³µì‚¬ (iFrame í˜¸í™˜ì„±)
                try {
                    const tempTextArea = document.createElement('textarea');
                    tempTextArea.value = textToCopy;
                    tempTextArea.style.position = 'absolute';
                    tempTextArea.style.left = '-9999px'; // í™”ë©´ ë°–ìœ¼ë¡œ
                    document.body.appendChild(tempTextArea);
                    
                    tempTextArea.select();
                    tempTextArea.setSelectionRange(0, 99999); // ëª¨ë°”ì¼ ê¸°ê¸° í˜¸í™˜ì„±

                    document.execCommand('copy');
                    
                    document.body.removeChild(tempTextArea);

                    // ì‚¬ìš©ì í”¼ë“œë°±
                    copyButton.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                    copyButton.classList.add('bg-green-500', 'text-white');
                    copyButton.classList.remove('bg-gray-300', 'hover:bg-gray-400', 'text-gray-800');
                    
                    setTimeout(() => {
                        copyButton.textContent = 'ë³µì‚¬';
                        copyButton.classList.remove('bg-green-500', 'text-white');
                        copyButton.classList.add('bg-gray-300', 'hover:bg-gray-400', 'text-gray-800');
                    }, 2000);

                } catch (err) {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    // ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì í”¼ë“œë°± (ì˜ˆ: alert ëŒ€ì‹ )
                    copyButton.textContent = 'ë³µì‚¬ ì‹¤íŒ¨';
                    copyButton.classList.add('bg-red-500', 'text-white');
                    setTimeout(() => {
                        copyButton.textContent = 'ë³µì‚¬';
                        copyButton.classList.remove('bg-red-500', 'text-white');
                    }, 2000);
                }
            });


            // --- Helper: API Exponential Backoff ---
            // API í˜¸ì¶œ ì‹œ ì¬ì‹œë„ë¥¼ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
            async function fetchWithBackoff(apiUrl, payload, maxRetries = 5) {
                let delay = 1000; // 1ì´ˆ
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            return await response.json();
                        } else if (response.status === 429 || response.status >= 500) {
                            // API ê³¼ë¶€í•˜ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ ì‹œ ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
                            // (ì½˜ì†” ë¡œê·¸ ì—†ìŒ)
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                        } else {
                            // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì˜¤ë¥˜ (ì¬ì‹œë„ ë¶ˆí•„ìš”)
                            throw new Error(`API Error: ${response.statusText}`);
                        }
                    } catch (error) {
                        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì¬ì‹œë„
                        if (i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                        } else {
                            // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë„ë‹¬
                            throw error;
                        }
                    }
                }
                throw new Error('API request failed after maximum retries.');
            }

            // --- 4. AI íŒ¨í„´ ìƒì„± í•¨ìˆ˜ ---
            async function generateAIPattern(keyword) {
                
                // ===================================================================
                // !! ì¤‘ìš” !!
                // 1ë‹¨ê³„ì—ì„œ ë°œê¸‰ë°›ì€ ë³¸ì¸ì˜ API í‚¤ë¥¼ ì´ê³³ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
                // mayo : AI Studio API
                // í‚¤ ì¡°ì‹¬
                // ===================================================================
                const apiKey = "AIzaSyAaBAyxJJGaEK9uejJ2Ul341ZuT65Dkurs"; 
                
                // API í‚¤ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
                if (!apiKey || apiKey.trim() === "" || apiKey.includes("AIzaSyAaBAyxJJGaEK9uejJ2Ul341ZuT65Dkurs")) {
                    console.error("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                    aiStatusMessage.textContent = 'API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì½”ë“œë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.';
                    aiStatusMessage.classList.add('text-red-600');
                    throw new Error("API Key is not set.");
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const systemPrompt = "You are an AI assistant for an 8x8 LED matrix display. Your task is to generate a simple, recognizable 8x8 bitmap pattern that represents a given keyword. You must respond *only* with a JSON object containing a single key 'pattern', which is an array of 8 integers. Each integer represents a row (from top to bottom), and its 8-bit binary representation defines which LEDs are on (1) or off (0). For example, the number 60 (binary 00111100) means the middle four LEDs are on. The array must have exactly 8 numbers, one for each row.";
                
                const userQuery = `Generate a pattern for the keyword: "${keyword}"`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "pattern": {
                                    type: "ARRAY",
                                    items: { type: "NUMBER" },
                                    minItems: 8, // 8x8 ê·¸ë¦¬ë“œ
                                    maxItems: 8  // 8x8 ê·¸ë¦¬ë“œ
                                }
                            },
                            required: ["pattern"]
                        }
                    }
                };

                try {
                    const result = await fetchWithBackoff(apiUrl, payload);
                    const candidate = result.candidates?.[0];
                    
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const jsonText = candidate.content.parts[0].text;
                        const parsedJson = JSON.parse(jsonText);
                        
                        if (parsedJson.pattern && Array.isArray(parsedJson.pattern) && parsedJson.pattern.length === 8) {
                            // 8ê°œì˜ ìˆ«ìë¡œ ì´ë£¨ì–´ì§„ ë°°ì—´ì¸ì§€ í™•ì¸
                            return parsedJson.pattern.map(num => Number(num) || 0); // ìˆ«ìë¡œ ë³€í™˜
                        }
                    }
                    // ìŠ¤í‚¤ë§ˆì™€ ë‹¤ë¥´ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ì‘ë‹µ
                    throw new Error('Invalid pattern data received from AI.');

                } catch (error) {
                    console.error('Error generating AI pattern:', error);
                    throw error; // ì—ëŸ¬ë¥¼ ìƒìœ„ë¡œ ì „íŒŒ
                }
            }

            // --- 5. UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
            function applyPatternToGrid(pattern) {
                for (let rowIdx = 0; rowIdx < yLabels.length; rowIdx++) {
                    const rowLabel = yLabels[rowIdx]; // '0x80', '0x40', ...
                    const rowValue = pattern[rowIdx]; // AIê°€ ìƒì„±í•œ ìˆ«ì (ì˜ˆ: 60)

                    for (let colIdx = 0; colIdx < xLabels.length; colIdx++) {
                        const colLabel = xLabels[colIdx]; // '1', '2', ...
                        
                        // ë¹„íŠ¸ ì—°ì‚°:
                        // colIdx 0 (1ì—´) -> 7ë²ˆì§¸ ë¹„íŠ¸ (1 << 7)
                        // colIdx 7 (8ì—´) -> 0ë²ˆì§¸ ë¹„íŠ¸ (1 << 0)
                        const bitMask = 1 << (7 - colIdx);
                        const isBitSet = (rowValue & bitMask) !== 0;

                        const cell = document.querySelector(`.grid-cell[data-col="${colLabel}"][data-row="${rowLabel}"]`);

                        if (cell) {
                            if (isBitSet) {
                                cell.classList.add('bg-red-500');
                                cell.classList.remove('bg-gray-200');
                            } else {
                                cell.classList.remove('bg-red-500');
                                cell.classList.add('bg-gray-200');
                            }
                        }
                    }
                }
                // ê·¸ë¦¬ë“œ ë³€ê²½ í›„ 16ì§„ìˆ˜ í•©ê³„ ì—…ë°ì´íŠ¸
                updateHexSums();
            }

            // 3-4. AI ì´ë¯¸ì§€ ìƒì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ìƒˆë¡œ ì¶”ê°€)
            aiImageButton.addEventListener('click', async () => {
                const keyword = keywordInput.value.trim();
                
                if (!keyword) {
                    aiStatusMessage.textContent = 'í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    aiStatusMessage.classList.add('text-red-600');
                    return;
                }

                // ë¡œë”© ìƒíƒœ ì‹œì‘
                aiImageButton.disabled = true;
                keywordInput.disabled = true;
                aiStatusMessage.textContent = 'AI íŒ¨í„´ ìƒì„± ì¤‘...';
                aiStatusMessage.classList.add('text-blue-600');
                aiStatusMessage.classList.remove('text-red-600');

                try {
                    const pattern = await generateAIPattern(keyword);
                    applyPatternToGrid(pattern);
                    aiStatusMessage.textContent = `"${keyword}" íŒ¨í„´ ìƒì„± ì™„ë£Œ!`;
                    aiStatusMessage.classList.remove('text-blue-600', 'text-red-600');

                } catch (error) {
                    // generateAIPattern í•¨ìˆ˜ì—ì„œ API í‚¤ê°€ ì—†ì„ ë•Œ ì´ë¯¸ ë©”ì‹œì§€ë¥¼ ì„¤ì •í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    if (!aiStatusMessage.textContent.includes('API í‚¤')) {
                        aiStatusMessage.textContent = 'íŒ¨í„´ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        aiStatusMessage.classList.add('text-red-600');
                    }
                    aiStatusMessage.classList.remove('text-blue-600');
                } finally {
                    // ë¡œë”© ìƒíƒœ ì¢…ë£Œ
                    aiImageButton.disabled = false;
                    keywordInput.disabled = false;
                }
            });


            // --- 6. ì´ˆê¸°í™” ---
            // í˜ì´ì§€ ë¡œë“œ ì‹œ í•©ê³„ ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            updateHexSums();
        });
    </script>
</body>
</html>
